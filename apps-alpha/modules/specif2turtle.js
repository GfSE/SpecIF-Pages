"use strict";
/*!
*   SpecIF to Turtle Transformation
*   (C)copyright enso managers gmbh (http://enso-managers.de)
*   Author: se@enso-managers.de, Berlin
*   License and terms of use: Apache 2.0 (http://www.apache.org/licenses/LICENSE-2.0)
*   We appreciate any correction, comment or contribution as Github issue (https://github.com/enso-managers/SpecIF-Tools/issues)
*
*   Assumptions:
*   - specifData is expected in v1.2 format.
*   - opts.baseURI ends with '/' or '#' ... check??
*   - identifiers have been replaced by ontology terms, if given in the respective title (method updateWithOntology)
*
*   SHACL
*       see: https://www.ontotext.com/knowledgehub/fundamentals/what-is-shacl/
*       and: https://book.validatingrdf.com/bookHtml011.html
*       and: https://graphdb.ontotext.com/documentation/10.8/shacl-validation.html
*       and: https://www.ida.liu.se/~robke04/SHACLTutorial/Introduction%20to%20SHACL.pdf
*       and: https://archive.topquadrant.com/technology/shacl/tutorial/
*       and: https://shacl.dev/article/Top_10_SHACL_rules_for_RDF_validation.html
*       and: https://www.w3.org/TR/shacl/
*
*   Andreas MÃ¼ller: Don't mix class and instance level in RDF triples!
*/var PigItemType,PigProperty,DcProperty,RdfProperty,ShaclProperty;!function(e){e.Property="pig:Property",e.aProperty="pig:aProperty",e.Link="pig:Link",e.aSourceLink="pig:aSourceLink",e.aTargetLink="pig:aTargetLink",e.Element="pig:Element",e.Organizer="pig:Organizer",e.anOrganizer="pig:anOrganizer",e.Entity="pig:Entity",e.anEntity="pig:anEntity",e.Relationship="pig:Relationship",e.aRelationship="pig:aRelationship",e.HierarchyRoot="pig:HierarchyRoot",e.Outline="pig:Outline",e.View="pig:View"}(PigItemType||(PigItemType={})),function(e){e.itemType="pig:itemType",e.eligibleValue="pig:eligibleValue",e.SourceLink="pig:SourceLink",e.TargetLink="pig:TargetLink",e.eligibleEndpoint="pig:eligibleEndpoint",e.eligibleProperty="pig:eligibleProperty",e.eligibleSourceLink="pig:eligibleSourceLink",e.eligibleTargetLink="pig:eligibleTargetLink",e.hasSourceLink="pig:hasSourceLink",e.hasTargetLink="pig:hasTargetLink",e.specializes="pig:specializes",e.lists="pig:lists",e.shows="pig:shows",e.depicts="pig:depicts",e.icon="pig:icon",e.category="pig:category",e.revision="pig:revision",e.priorRevision="pig:priorRevision"}(PigProperty||(PigProperty={})),function(e){e.title="dcterms:title",e.description="dcterms:description",e.type="dcterms:type",e.modified="dcterms:modified",e.creator="dcterms:creator",e.license="dcterms:license"}(DcProperty||(DcProperty={})),function(e){e.type="rdf:type",e.label="rdfs:label",e.comment="rdfs:comment",e.subClassOf="rdfs:subClassOf",e.subPropertyOf="rdfs:subPropertyOf",e.domain="rdfs:domain",e.range="rdfs:range"}(RdfProperty||(RdfProperty={})),function(e){e.nodeShape="sh:NodeShape",e.propertyShape="sh:PropertyShape",e.targetClass="sh:targetClass",e.property="sh:property",e.path="sh:path",e.class="sh:class",e.datatype="sh:datatype",e.maxLength="sh:maxLength",e.minInclusive="sh:minInclusive",e.maxInclusive="sh:maxInclusive",e.minCount="sh:minCount",e.maxCount="sh:maxCount",e.pattern="sh:pattern",e.or="sh:or"}(ShaclProperty||(ShaclProperty={}));const nsData="d:",nsOnto="o:",sfx_toSrc="-toSource",sfx_toTrg="-toTarget",pfx_datatype="xs:",pfx_shape="pigShapes_",sfx_shape="_shape",pigOnto="https://product-information-graph.org/v0.2/ontology",nsShapes=["dcterms:","rdfs:","uml:","sysml:","FMC:","RFLP:","IREB:","oslc_rm:","oslc_cm:","ReqIF:","ReqIF-WF:","SpecIF:","pig:"],pigEntities=[[PigItemType.Entity,"owl:Class","Entity","A PIG meta-model element used for entities (aka resources or artifacts).",[PigProperty.category,PigProperty.icon],[]],[PigItemType.Organizer,PigItemType.Entity,"Organizer","An element organizing model elements. An example is a list of requirements or a diagram using a certain notation.",[PigProperty.category],[]],[PigItemType.HierarchyRoot,PigItemType.Organizer,"Hierarchy Root","A subclass of PIG organizer serving as a root for hierarchically organized graph elements.",[],[PigProperty.lists]],[PigItemType.Outline,PigItemType.Organizer,"Outline","A subclass of PIG organizer comprising all information items of a human-readable document. As usual, the outline is hierarchically organized.",[PigProperty.category],[PigProperty.lists]],[PigItemType.View,PigItemType.Organizer,"View","A subclass of PIG organizer representing a model view (diagram) using a certain notation showing selected model elements.",[PigProperty.category,PigProperty.icon],[PigProperty.shows,PigProperty.depicts]]],pigRelationships=[[PigItemType.Relationship,"owl:Class","Relationship","A PIG meta-model element used for reified relationships (aka predicates).",[PigProperty.category,PigProperty.icon],PigProperty.SourceLink,PigProperty.TargetLink]],pigProperties=[[PigProperty.icon,"owl:DatatypeProperty",[PigItemType.Entity,PigItemType.Relationship],XsDataType.String,"has icon","Specifies an icon for a model element (entity or relationship).",void 0,0,1],[PigProperty.category,DcProperty.type,[PigItemType.Entity,PigItemType.Relationship],XsDataType.String,"has category","Specifies a category for an element (entity, relationship or organizer).",32,0,1]],pigLinks=[[PigItemType.Link,"owl:ObjectProperty",[PigItemType.Organizer,PigItemType.Relationship],[PigItemType.Entity,PigItemType.Relationship],"linked with","Connects a reified relationship with its source or target. Also connects an organizer to a model element"],[PigProperty.SourceLink,PigItemType.Link,[PigItemType.Relationship],[PigItemType.Entity,PigItemType.Relationship],"to source","Connects the source of a reified relationship."],[PigProperty.TargetLink,PigItemType.Link,[PigItemType.Relationship],[PigItemType.Entity,PigItemType.Relationship],"to target","Connects the target of a reified relationship or an organizer."],[PigProperty.lists,PigProperty.TargetLink,[PigItemType.HierarchyRoot,PigItemType.Outline],[PigItemType.Entity,PigItemType.Relationship,PigItemType.Organizer],"lists","Lists an entity, a relationship or a subordinated organizer."],[PigProperty.shows,PigProperty.TargetLink,[PigItemType.View],[PigItemType.Entity,PigItemType.Relationship],"shows","Shows an entity or a relationship."],[PigProperty.depicts,PigProperty.TargetLink,[PigItemType.View],[PigItemType.Entity],"depicts","Depicts an entity; inverse of uml:ownedDiagram."]],pigNativeProperties=["dcterms:title","dcterms:description"],rdfImplicit=["rdf","rdfs","owl","xs","xsd"],diagramRels=["SpecIF:shows","uml:ownedDiagram"],hierarchyItems=[CONFIG.resClassFolder,CONFIG.resClassOutline,CONFIG.resClassGlossary],excludeEntities=[PigItemType.Element].concat(pigEntities.map((e=>e[0]))),excludeRelationships=pigRelationships.map((e=>e[0])),excludeProperties=pigProperties.concat(pigLinks).map((e=>e[0]));function isRdfImplicit(e){return rdfImplicit.includes(e.split(":")[0])}function isPigNative(e){return pigNativeProperties.includes(e)}function makeShapeId(e){return e.startsWith("o:")?e+"_shape":pfx_shape+e}class CToRdf{constructor(){this.lastTab=-1}heading(e){return this.newLine()+this.newLine("#################################################################")+this.newLine("# "+e)+this.newLine("#################################################################")}newLine(e){if(0==this.lastTab)throw Error("Previous triple is incomplete");let t=this.lastTab<0?"":" .";return this.lastTab=-1,t+"\n"+(e||"")}prefix(e,t){return this.newLine(`@prefix ${e} <${t}> .`)}tab0(e){if(0==this.lastTab)throw Error("Previous triple is incomplete");let t=this.lastTab<0?"":" .";return this.lastTab=0,t+`\n${e}`}tab1(e,t){if(this.lastTab<0)throw Error("Subject is missing");if(null!=t){let r=this.lastTab<1?"":" ;";return this.lastTab=1,this.makeLines(r+`\n\t${e} `,t)}return""}tab2(e){if(this.lastTab<1)throw Error("Predicate is missing");if(null!=e){let t=" ,";return this.lastTab=2,this.makeLines(t+"\n\t\t",e)}return""}makeLines(e,t){switch(typeof t){case"undefined":return"";case"number":case"boolean":t=t.toString();case"string":return t.length>0?this.isNotLiteral(t)?e+t:e+`"${this.escapeTtl(t)}"`:"";default:if(!LIB.isArrayWithContent(t))return console.error("specif2turtle: Expecting an array with items"),"";if(LIB.isMultiLanguageValue(t)){if(t.length<2){let r=t[0].text,i=t[0].language;if(this.isNotLiteral(r))return e+`${r}`;let a=i?`@${i}`:"";return e+`"${this.escapeTtl(r)}"`+a}let r="";return t.forEach(((t,i)=>{t.language||console.error("specif2turtle: Multilanguage text must have a language specified if there are multiple language versions:",t),r+=(0==i?e:" ,\n\t\t")+`"${this.escapeTtl(t.text)}"@${t.language}`})),r}{let r="";return t.forEach(((t,i)=>{r+=(0==i?e:" ,\n\t\t")+(this.isNotLiteral(t)?t:`"${t}"`)})),r}}}makeRdflList(e,t){let r="";if(Array.isArray(t)&&t.length>0){r="(";for(let i of t)r+="\n\t\t\t"+LIB.makeIdWithNamespace(e,i.id??i);r+="\n\t\t)"}return r}makeShaclList(e){let t="";if(Array.isArray(e)&&e.length>0){t="[ ";for(let r=0;r<e.length;r++)e[r].obj&&(t+="\n\t\t"+e[r].prd+" "+e[r].obj+(r<e.length-1?" ;":""));t+="\n\t]"}return t}makeShaclOr(e,t,r){if(LIB.isArrayWithContent(r)){let i="(";return r.forEach((r=>{i+="\n\t\t\t[ "+t+" "+LIB.makeIdWithNamespace(e,r.id??r)+" ]"})),i+"\n\t\t)"}console.error("specif2turtle: Expecting an array of property shapes for 'sh:or'")}makeOwlUnion(e,t){let r="";return LIB.isArrayWithContent(t)&&(t.length>1?(t.length>10&&console.warn("specif2turtle: Many elements in a union: "+t.length+", beware of performance issues with RDF processors."),r="[ owl:unionOf"+this.makeRdflList(e,t)+"]"):r+=LIB.makeIdWithNamespace(e,t[0].id??t[0])),r}escapeTtl(e){if(e)return e.replace("\\","\\\\").replace(/"/g,"\\$&").replace(/\u000a/g,"\\n").replace(/\u000d/g,"")}isNotLiteral(e){return RE.Namespace.test(e)||e.startsWith("<http")||RE.contentInRoundBrackets.test(e)||RE.contentInSquareBrackets.test(e)}}app.specif2turtle=(e,t)=>{const r=(new Date).toISOString(),i=encodeURI((t.sourceFileName.startsWith("http")?t.sourceFileName:t.baseURI+t.sourceFileName)+"#"),a=pigOnto+"#",o=LIB.getExtendedClasses(e.resourceClasses,"all").concat(LIB.getExtendedClasses(e.statementClasses,"all"));let s=new CToRdf,n=function(){const t=new Set;function r(e){if(!e)return;const r=e.match(/^([\w-]+)(:|\.)/);r&&t.add(r[1])}t.add("rdf"),t.add("sh"),t.add("owl"),t.add("pig"),t.add("pigShapes_pig"),[e.dataTypes,e.propertyClasses,e.resourceClasses,e.statementClasses,e.resources,e.statements].forEach((e=>{Array.isArray(e)&&e.forEach((e=>{r(e.id),r(e.type),r(e.class?.id),r(e.dataType?.id),r(e.extends?.id),Array.isArray(e.propertyClasses)&&e.propertyClasses.forEach((e=>r(e.id))),["subjectClasses","objectClasses"].forEach((t=>{Array.isArray(e[t])&&e[t].forEach((e=>r(e.id)))})),Array.isArray(e.properties)&&e.properties.forEach((e=>r(LIB.isMultiLanguageValue(e.values[0])?LIB.languageTextOf(e.values[0],{targetLanguage:"default"}):void 0)))}))}));let o="";for(let[e,r]of app.ontology.namespaces){const i=e.replace(/[\.:]$/,"");t.has(i)&&(o+=s.prefix(i+":",r.url))}if(LIB.isArrayWithContent(nsShapes))for(let e of nsShapes){e.endsWith(":")||(e+=":",console.warn("specif2turtle: Added a colon to namespace prefix:",e));const r=e.replace(":","");t.has(r)&&(o+=s.prefix(pfx_shape+e,pigOnto+"/shapes/"+e+"#"))}return o+=s.newLine()+s.prefix("o:",a)+s.prefix("d:",i),o}()+function(e){let{id:t,title:r,description:i,$schema:a,generator:o,generatorVersion:n,rights:p,createdAt:l,createdBy:c}=e;return s.heading("Project Metadata")+s.newLine()+s.tab0("d:")+s.tab1(RdfProperty.type,"owl:Ontology")+s.tab1(RdfProperty.label,r)+s.tab1(RdfProperty.comment,i)+s.tab1("owl:imports","<http://www.w3.org/1999/02/22-rdf-syntax-ns#>")+s.tab2("<http://www.w3.org/2000/01/rdf-schema#>")+(p?s.tab1(DcProperty.license,"<"+p.url+">"):"")+(c?s.tab1(DcProperty.creator,"<mailto:"+c.email+">"):"")+s.tab1(DcProperty.modified,l)}(e)+function(){let e=s.heading("PIG Metamodel (pig:)");return pigEntities.forEach((t=>{let r=[RdfProperty.label,RdfProperty.comment].concat(t[4]).concat(t[5]);e+=s.newLine()+s.tab0(t[0])+s.tab1(t[1].startsWith("owl:")?RdfProperty.type:RdfProperty.subClassOf,t[1])+s.tab1(RdfProperty.label,t[2])+s.tab1(RdfProperty.comment,t[3])+s.newLine()+s.tab0(pfx_shape+t[0])+s.tab1(RdfProperty.type,ShaclProperty.nodeShape)+s.tab1(ShaclProperty.targetClass,t[0])+s.tab1(ShaclProperty.property,LIB.isArrayWithContent(r)?r.map((e=>pfx_shape+e)):void 0)})),pigRelationships.forEach((t=>{let r=[RdfProperty.label,RdfProperty.comment].concat(t[4]).concat([t[5],t[6]]);e+=s.newLine()+s.tab0(t[0])+s.tab1(t[1].startsWith("owl:")?RdfProperty.type:RdfProperty.subClassOf,t[1])+s.tab1(RdfProperty.label,t[2])+s.tab1(RdfProperty.comment,t[3])+s.newLine()+s.tab0(pfx_shape+t[0])+s.tab1(RdfProperty.type,ShaclProperty.nodeShape)+s.tab1(ShaclProperty.targetClass,t[0])+s.tab1(ShaclProperty.property,LIB.isArrayWithContent(r)?r.map((e=>pfx_shape+e)):void 0)})),pigProperties.concat(pigLinks).forEach((t=>{e+=s.newLine()+s.tab0(t[0])+s.tab1(t[1].startsWith("owl:")||t[1].startsWith("rdf:")?RdfProperty.type:RdfProperty.subPropertyOf,t[1])+s.tab1(RdfProperty.range,s.makeOwlUnion("o:",t[3]))+s.tab1(RdfProperty.label,t[4])+s.tab1(RdfProperty.comment,t[5])+s.newLine()+s.tab0(pfx_shape+t[0])+s.tab1(RdfProperty.type,ShaclProperty.propertyShape)+s.tab1(ShaclProperty.path,t[0]),"string"==typeof t[3]&&t[3].startsWith("xs:")?(e+=s.tab1(ShaclProperty.datatype,t[3]),e+=s.tab1(ShaclProperty.maxLength,t[6]),e+=s.tab1(ShaclProperty.minCount,t[7]),e+=s.tab1(ShaclProperty.maxCount,t[8])):e+=s.tab1(ShaclProperty.or,s.makeShaclOr("o:",ShaclProperty.class,t[3]))})),e}()+function(e){if(!LIB.isArrayWithContent(e))return"";if(!function(){for(let t of e)if(LIB.isArrayWithContent(t.enumeration))return!0}())return"";let t=s.heading("Data Types with Enumerated Values");return e.forEach((e=>{const r=LIB.makeIdWithNamespace("o:",e.id);LIB.isArrayWithContent(e.enumeration)&&(t+=s.newLine()+s.tab0(r)+s.tab1(RdfProperty.type,"owl:Class")+s.tab1(RdfProperty.label,e.title)+s.tab1(RdfProperty.comment,e.description)+s.tab1("owl:oneOf",s.makeRdflList("o:",e.enumeration.map((e=>e.id)))),e.enumeration.forEach((e=>{const i=LIB.makeIdWithNamespace("o:",e.id);t+=s.tab0(i)+s.tab1(RdfProperty.type,r)+s.tab1(RdfProperty.label,e.value)})))})),t}(e.dataTypes)+function(t){if(!LIB.isArrayWithContent(t))return"";let r=s.heading("Ontology - Property Classes");return t.forEach((t=>{const i=LIB.itemByKey(e.dataTypes,t.dataType),a=LIB.makeIdWithNamespace("o:",t.id);if(excludeProperties.includes(a)||isRdfImplicit(a))r+=s.newLine()+s.newLine("# Skipping implicit property: "+a);else{r+=s.newLine()+s.tab0(a)+s.tab1(RdfProperty.type,i.enumeration?"owl:ObjectProperty":"owl:DatatypeProperty")+s.tab1(RdfProperty.label,t.title)+s.tab1(RdfProperty.comment,t.description)+s.tab1(RdfProperty.range,i.enumeration?LIB.makeIdWithNamespace("o:",i.id):void 0);const e=i.type;r+=s.newLine()+s.tab0(makeShapeId(a))+s.tab1(RdfProperty.type,ShaclProperty.propertyShape)+s.tab1(ShaclProperty.path,a)+s.tab1(ShaclProperty.minCount,t.required?1:void 0)+s.tab1(ShaclProperty.maxCount,t.multiple?void 0:1),i.enumeration?r+=s.tab1(ShaclProperty.class,LIB.makeIdWithNamespace("o:",i.id)):r+=s.tab1(ShaclProperty.datatype,e)+s.tab1(ShaclProperty.maxLength,i.maxLength)+s.tab1(ShaclProperty.minInclusive,i.minInclusive)+s.tab1(ShaclProperty.maxInclusive,i.maxInclusive)+s.tab1(ShaclProperty.pattern,i.fractionDigits?`^\\d+(\\\\.\\\\d{0,${i.fractionDigits}})?$`:void 0)}})),r}(e.propertyClasses)+function(e){if(!LIB.isArrayWithContent(e))return"";let t=s.heading("Ontology - Entity Classes");return e.forEach((e=>{if(excludeEntities.includes(e.id)||isRdfImplicit(e.id))return;const r=LIB.itemByKey(o,LIB.keyOf(e)),i=LIB.makeIdWithNamespace("o:",e.id),a=app.ontology.organizerClasses.includes(i)?PigItemType.Organizer:PigItemType.Entity;t+=s.newLine()+s.tab0(i)+s.tab1(RdfProperty.subClassOf,e.extends?LIB.makeIdWithNamespace("o:",e.extends.id):a)+s.tab1(RdfProperty.label,e.title)+s.tab1(RdfProperty.comment,e.description)+s.tab1(PigProperty.icon,e.icon),t+=p(r)})),t}(e.resourceClasses)+function(e){if(!LIB.isArrayWithContent(e))return"";let t=s.heading("Ontology - Relationship Classes");return e.forEach((e=>{if(excludeRelationships.includes(e.id)||isRdfImplicit(e.id)||diagramRels.includes(e.id))return;const r=LIB.itemByKey(o,LIB.keyOf(e)),i=LIB.makeIdWithNamespace("o:",e.id);t+=s.newLine()+s.tab0(i)+s.tab1(RdfProperty.subClassOf,e.extends?LIB.makeIdWithNamespace("o:",e.extends.id):PigItemType.Relationship)+s.tab1(RdfProperty.label,e.title)+s.tab1(RdfProperty.comment,e.description)+s.tab1(PigProperty.icon,e.icon)+s.newLine()+s.tab0(i+sfx_toSrc)+s.tab1(RdfProperty.subPropertyOf,PigProperty.SourceLink)+s.tab1(RdfProperty.label,i+" to source")+s.tab1(RdfProperty.comment,"Connects the source of "+i)+s.tab1(RdfProperty.domain,i)+s.tab1(RdfProperty.range,s.makeOwlUnion("o:",e.subjectClasses))+s.newLine()+s.tab0(i+sfx_toTrg)+s.tab1(RdfProperty.subPropertyOf,PigProperty.TargetLink)+s.tab1(RdfProperty.label,i+" to target")+s.tab1(RdfProperty.comment,"Connects the target of "+i)+s.tab1(RdfProperty.domain,i)+s.tab1(RdfProperty.range,s.makeOwlUnion("o:",e.objectClasses))+p(r)+s.tab1(ShaclProperty.property,s.makeShaclList([{prd:ShaclProperty.path,obj:i+sfx_toSrc},{prd:ShaclProperty.or,obj:s.makeShaclOr("o:",ShaclProperty.class,e.subjectClasses)},{prd:ShaclProperty.minCount,obj:"1"},{prd:ShaclProperty.maxCount,obj:"1"}]))+s.tab1(ShaclProperty.property,s.makeShaclList([{prd:ShaclProperty.path,obj:i+sfx_toTrg},{prd:ShaclProperty.or,obj:s.makeShaclOr("o:",ShaclProperty.class,e.objectClasses)},{prd:ShaclProperty.minCount,obj:"1"},{prd:ShaclProperty.maxCount,obj:"1"}]))})),t}(e.statementClasses)+function(t){if(LIB.isArrayWithContent(t)){let r=s.heading("Entities");return t.forEach((t=>{if(!hierarchyItems.includes(t.class.id)&&(r+=c(t),"pig:View"===t.class.id)){let i=e.statements.filter((e=>e.class.id.includes(":shows")&&e.subject.id==t.id));if(i.length>0){let e=i.map((e=>LIB.makeIdWithNamespace("d:",e.object.id)));r+=s.tab1(PigProperty.shows,s.makeRdflList("d:",e))}if(i=e.statements.filter((e=>e.class.id.includes(":ownedDiagram")&&e.object.id==t.id)),i.length>0){let e=i.map((e=>LIB.makeIdWithNamespace("d:",e.subject.id)));r+=s.tab1(PigProperty.depicts,s.makeRdflList("d:",e))}}})),r}return""}(e.resources)+function(e){if(LIB.isArrayWithContent(e)){let t=s.heading("Relationships");return e.forEach((e=>{let r=LIB.makeIdWithNamespace("o:",e.class.id);switch(r){case"SpecIF:shows":case"uml:ownedDiagram":break;default:t+=s.newLine()+s.tab0("d:"+e.id)+s.tab1(RdfProperty.type,r)+s.tab1(r+sfx_toSrc,"d:"+e.subject.id)+s.tab1(r+sfx_toTrg,"d:"+e.object.id)+l(e)+s.tab1(DcProperty.modified,e.changedAt)+s.tab1(DcProperty.creator,e.changedBy)}})),t}return""}(e.statements)+function(t){if(LIB.isArrayWithContent(t)){let i=s.heading("Hierarchy")+s.newLine()+s.tab0("d:HierarchyRoot-"+e.id)+s.tab1(RdfProperty.type,PigItemType.HierarchyRoot)+toRdf.tab1(DcProperty.modified,r)+s.tab1(RdfProperty.label,"Hierarchy Root")+s.tab1(RdfProperty.comment,"... anchoring all hierarchies of this graph (package)");return i+=s.tab1(PigProperty.lists,s.makeRdflList("d:",t.map((e=>e.resource.id)))),LIB.iterateSpecifNodes(t,(t=>{const r=LIB.itemById(e.resources,t.resource.id);return hierarchyItems.includes(r.class.id)&&(i+=c(r),LIB.isArrayWithContent(t.nodes)&&(i+=s.tab1(PigProperty.lists,s.makeRdflList("d:",t.nodes.map((e=>e.resource.id)))))),!0})),i}return""}(e.nodes)+s.newLine();return console.debug("rdf.ttl",n),n;function p(e){const t=LIB.makeIdWithNamespace("o:",e.id);let r=s.newLine()+s.tab0(makeShapeId(t))+s.tab1(RdfProperty.type,ShaclProperty.nodeShape)+s.tab1(ShaclProperty.targetClass,t);if(LIB.isArrayWithContent(e.propertyClasses)){e.propertyClasses.filter((e=>!isPigNative(e.id))).forEach(((e,t)=>{r+=t<1?s.tab1(ShaclProperty.property,makeShapeId(LIB.makeIdWithNamespace("o:",e.id))):s.tab2(makeShapeId(LIB.makeIdWithNamespace("o:",e.id)))}))}return r}function l(e){let t="";return LIB.isArrayWithContent(e.properties)&&e.properties.forEach((e=>{if(e.values.length>0){let r=LIB.makeIdWithNamespace("o:",e.class.id);e.values[0].id?t+=s.tab1(r,e.values.map((e=>LIB.makeIdWithNamespace("o:",e.id)))):(e.values.length>1&&console.warn("specif2turtle: Only the first value of a property is transformed:",e),t+=s.tab1(r,e.values[0]))}})),t}function c(e){return s.newLine()+s.tab0("d:"+e.id)+s.tab1(RdfProperty.type,LIB.makeIdWithNamespace("o:",e.class.id))+l(e)+s.tab1("pig:revision",e.revision)+s.tab1("pig:priorRevision",e.replaces)+s.tab1(DcProperty.modified,e.changedAt??r)+s.tab1(DcProperty.creator,e.changedBy)}};
