"use strict";const LIB={};function popOver(e){return e?' data-toggle="popover" title="'+LIB.displayValueOf(e,{targetLanguage:browser.language,stripHTML:!0})+'" ':""}function makeTextField(e,t,r){let s;r||(r={}),"string"!=typeof r.tagPos&&(r.tagPos="left"),s="number"==typeof r.tagCols?"col-"+r.tagCols:"col-3";let a,i,n="string"==typeof r.handle&&r.handle.length>0?' oninput="'+r.handle+'"':"",l=simpleHash(e),o="string"==typeof r.classes&&r.classes.length>0?" "+r.classes:"";switch(a=r.typ&&["line","area","outer"].includes(r.typ)?'<div id="'+l+'" class="row attribute form-active'+o+'" >':'<div class="row attribute'+o+'" >',r.tagPos){case"none":i="col-12";break;case"left":a+='<div class="'+s+' attribute-label"'+popOver(r.hint)+">"+e+"</div>",i="col attribute-value";break;default:throw Error("Invalid display option '"+r.tagPos+"' when showing a text form")}switch(r.typ&&!["outer"].includes(r.typ)&&(t=LIB.noCode(t||"")),r.typ){case"line":a+='<div class="'+i+'">'+(t.includes("\n")?'<textarea id="field'+l+'" class="form-control" rows="2"'+n+">"+t+"</textarea>":'<input type="text" id="field'+l+'" class="form-control"'+n+' value="'+t+'" />')+"</div>";break;case"area":a+='<div class="'+i+'"><textarea id="field'+l+'" class="form-control" rows="7"'+n+">"+t+"</textarea></div>";break;case"outer":a+='<div class="'+i+'">'+t+"</div>";break;default:a+='<div id="field'+l+'" class="'+i+'" >'+t+"</div>"}return a+="</div>",a}function setTextValue(e,t){t=LIB.noCode(t||"");let r=document.getElementById("field"+simpleHash(e));r&&r.nodeName&&"div"==r.nodeName.toLowerCase()?r.innerHTML=t:r&&(r.value=t)}function setFocus(e){let t=document.getElementById("field"+simpleHash(e));t&&t.focus()}function setTextState(e,t){if(["is-valid","is-invalid"].indexOf(t)<0)throw Error("Invalid state '"+t+"'");let r=$("#field"+simpleHash(e));return!!r&&(r.hasClass("is-invalid")?"is-valid"==t&&(r.removeClass("is-invalid").addClass("is-valid"),!0):r.hasClass("is-valid")?"is-invalid"==t&&(r.removeClass("is-valid").addClass("is-invalid"),!0):(r.addClass(t),!0))}function textValue(e){try{return LIB.noCode(document.getElementById("field"+simpleHash(e)).value).escapeJSON()||""}catch(e){return""}}function getTextLength(e){try{return textValue(e).length}catch(e){return-1}}function makeSelectionField(e,t,r){if(!r||!r.kind||!["radio","checkbox"].includes(r.kind))throw Error("Kind of selection field must be either 'radio' or 'checkbox'");if("display"===r.typ)return'<div class="row attribute '+(r.classes||"")+'"><div class="col-3 attribute-label"'+popOver(r.hint)+">"+e+'</div><div class="col attribute-value" >'+function(){let e="";return t.forEach((t=>{e+=t.checked?(e.length>0?", ":"")+t.title:""})),e}()+"</div></div>";"string"!=typeof r.tagPos&&(r.tagPos="left"),"string"!=typeof r.classes&&(r.classes="form-active");let s='<div class="row attribute '+(r.classes||"")+'">',a="string"==typeof r.handle&&r.handle.length>0?' onclick="'+r.handle+'"':"";switch(r.tagPos){case"none":s+='<div class="'+r.kind+'" >';break;case"left":s+='<div class="col-3 attribute-label"'+popOver(r.hint)+">"+e+'</div><div class="col attribute-value '+r.kind+'" >';break;default:throw Error("Invalid display option '"+r.tagPos+"' when showing a '"+r.kind+"' form")}if("radio"==r.kind){let e,r=!1;t.forEach((t=>{e=r||!!t.checked,r&&t.checked&&(t.checked=!1),r=e}))}return t.forEach(((t,i)=>{s+='<label><input type="'+r.kind+'" name="'+r.kind+simpleHash(e)+'" value="'+(t.id||i)+'"'+(t.checked?" checked":"")+a+" /><span "+popOver(t.description)+">&#160;"+t.title+(t.type?"&#160;("+t.type+")":"")+"</span></label><br />"})),s+="</div></div>",s}function makeRadioField(e,t,r){return r||(r={}),r.kind="radio",makeSelectionField(e,t,r)}function radioValue(e){return $('input[name="radio'+simpleHash(e)+'"]:checked').attr("value")||""}function makeCheckboxField(e,t,r){return r||(r={}),r.kind="checkbox",makeSelectionField(e,t,r)}function checkboxValues(e){let t=$('input[name="checkbox'+simpleHash(e)+'"]:checked');var r=[];return Array.from(t,(e=>{r.push(e.value)})),r}function makeBooleanField(e,t,r){r||(r={});let s="";return"string"==typeof r.handle&&r.handle.length>0&&(s=' onclick="'+r.handle+'"'),"display"===r.typ?'<div class="row attribute"><div class="col-3 attribute-label"'+popOver(r.hint)+">"+e+'</div><div class="col attribute-value">'+(t?"true":"false")+"</div></div>":'<div class="row attribute form-active"><div class="col-3 attribute-label"'+popOver(r.hint)+">"+e+'</div><div class="col attribute-value checkbox" ><label><input type="checkbox" name="boolean'+simpleHash(e)+'"'+(t?" checked":"")+s+" /></label><br /></div></div>"}function booleanValue(e){return $('input[name="boolean'+simpleHash(e)+'"]:checked').length>0}function tagId(e){return"X-"+simpleHash(e||"")}class CCheckDialogInput{constructor(){this.list=[]}addField(e,t,r){this.list.push({label:e,dataType:t,options:r})}check(){let e,t=!0,r=!0,s=!0;return this.list.forEach((a=>{switch(s=!(a.options&&a.options.required),e=textValue(a.label),a.dataType.type){case XsDataType.String:t=null==a.dataType.maxLength||e.length<=a.dataType.maxLength;break;case XsDataType.Double:t=s&&e.length<1||RE.Real(a.dataType.fractionDigits).test(e)&&!("number"==typeof a.dataType.minInclusive&&parseFloat(e)<a.dataType.minInclusive)&&!("number"==typeof a.dataType.maxInclusive&&parseFloat(e)>a.dataType.maxInclusive);break;case XsDataType.Integer:t=s&&e.length<1||RE.Integer.test(e)&&!("number"==typeof a.dataType.minInclusive&&parseFloat(e)<a.dataType.minInclusive)&&!("number"==typeof a.dataType.maxInclusive&&parseFloat(e)>a.dataType.maxInclusive);break;case XsDataType.DateTime:t=s&&e.length<1||LIB.isIsoDateTime(e);break;case XsDataType.AnyURI:RE.URI.test(""),t=s&&e.length<1||RE.URI.test(e);break;default:t=!0}setTextState(a.label,t?"is-valid":"is-invalid"),r=r&&t})),r}}class resultMsg{constructor(e,t,r,s){this.status=e,this.statusText=t,this.responseType=r,this.response=s}ok(){return["0","200","201"].includes(this.status.toString())}asString(){return this.statusText+" ("+this.status+("text"==this.responseType?"): "+(this.response||this.responseText):")")}log(){return console.log(this.asString()),this}warn(){return console.warn(this.asString()),this}}LIB.stdError=(e,t)=>{let r=new resultMsg(e.status,e.statusText,e.responseType,"text"==e.responseType?e.response||e.responseText:"");switch(e.status){case 0:case 200:case 201:return;case 401:app.me.logout();break;case 402:r.responseType="text",r.response=i18n.Err402InsufficientLicense,message.show(r);break;case 403:r.responseType="text",r.response=i18n.Err403Forbidden,message.show(r);break;case 404:r.responseType="text",r.response="string"==typeof r.response&&r.response.length>0?r.response:i18n.Err404NotFound,message.show(r);break;default:message.show(e)}r.log(),"function"==typeof t&&t()};class CMessage{constructor(){this.pend=0,$("#app").prepend('<div id="message" ></div>')}hide(){$("#message").empty().hide(),this.pend=0}remove(){--this.pend<1&&this.hide()}show(e,t){switch(t||(t={}),typeof e){case"string":if(e.length>0)break;return void this.hide();case"object":if(e.status){t.severity||(t.severity=e.status<202?"success":"danger"),e=(e.statusText||i18n.Error)+" ("+e.status+("text"==e.responseType?"): "+(e.response||e.responseText):")");break}default:return void console.error(e," is an invalid message.")}(!t.severity||["primary","secondary","success","info","warning","error","danger"].indexOf(t.severity)<0)&&(t.severity="warning"),"error"==t.severity&&(t.severity="danger"),t.duration&&"number"==typeof t.duration||(t.duration=CONFIG.messageDisplayTimeNormal),$("#message").html('<div class="alert alert-'+t.severity+'" role="alert" >'+e+"</div>").show(),t.duration>10&&(this.pend++,setTimeout((()=>{this.remove()}),t.duration))}}function simpleHash(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return 1e10+t}function simpleClone(e){function t(e){return"object"==typeof e?simpleClone(e):e}if(null!=e){if("object"==typeof e&&!(e instanceof Blob)){var r;for(var s in r=Array.isArray(e)?[]:{},e)Array.isArray(e[s])?(r[s]=[],e[s].forEach((e=>{r[s].push(t(e))}))):r[s]=t(e[s]);return r}if("function"!=typeof e)return e}}function getUrlParams(e){"object"!=typeof e&&(e={}),"string"!=typeof e.start&&(e.start="#"),"string"!=typeof e.separator&&(e.separator=";");let t=document.URL.split(e.start);return t[1]?function(t){if(!t)return{};"/"==t.charAt(0)&&(t=t.substring(1));var r={};return t.split(e.separator).forEach((e=>{(e=e.split("="))[1]&&['"',"'"].includes(e[1][0])&&(e[1]=e[1].substring(1,e[1].length-1)),CONFIG.urlParamTags.includes(e[0])?r[e[0]]=e[1]:console.warn("Unknown URL-Parameter '",e[0],"' found.")})),r}(decodeURI(t[1])):{}}function setUrlParams(e){if(!browser.supportsHtml5History||!e)return;let t=getUrlParams(),r=e.view.substring(1);if(t.project==e.project&&t[CONFIG.keyView]==r&&t[CONFIG.keyNode]==e.node)return;let s=window.location.pathname.split("/"),a=s[s.length-1],i="=";a+="#"+CONFIG.keyView+i+r+(e.project?";"+CONFIG.keyProject+i+e.project:"")+(e.node?";"+CONFIG.keyNode+i+e.node:e.item?";"+CONFIG.keyItem+i+e.item:""),history.pushState("","",a)}LIB.isKey=e=>"object"==typeof e&&e.id,LIB.keyOf=e=>e.revision?{id:e.id,revision:e.revision}:{id:e.id},LIB.makeKey=e=>e?"string"==typeof e?{id:e}:LIB.keyOf(e):void 0,LIB.replacePrefix=(e,t)=>t.replace(RE.isolatePrefix,((t,r,s)=>e+s)),LIB.containsAllKeys=(e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(e.length<t.length)return!1;for(var r of t)if(LIB.indexByKey(e,r)<0)return!1;return!0}throw Error("Both input parameters must be an array.")},LIB.equalKey=(e,t)=>e.id==t.id&&e.revision==t.revision,LIB.equalKeyL=(e,t)=>{let r=Array.isArray(e)&&e.length>0,s=Array.isArray(t)&&t.length>0;return!r&&!s||!(!r&&s||r&&!s||e.length!=t.length)&&LIB.containsAllKeys(e,t)},LIB.equalValue=(e,t)=>typeof e==typeof t&&(LIB.isString(e)?e==t:!!LIB.isMultiLanguageValue(e)&&(e.text==t.text&&e.language==t.language&&e.format==t.format)),LIB.equalValues=(e,t)=>{if(e.length!=t.length)return!1;for(var r=t.length-1;r>-1;r--)if(!LIB.equalValue(e[r],t[r]))return!1;return!0},LIB.equalBoolean=(e,t)=>e&&t||!e&&!t,LIB.equalDT=(e,t)=>{if(e.type!=t.type)return!1;switch(e.type){case XsDataType.Double:if(e.fractionDigits!=t.fractionDigits)return!1;case XsDataType.Integer:if(e.minInclusive!=t.minInclusive||e.maxInclusive!=t.maxInclusive)return!1;break;case XsDataType.String:if(e.maxLength!=t.maxLength)return!1}if(!Array.isArray(e.enumeration)&&!Array.isArray(t.enumeration))return!0;if(Array.isArray(e.enumeration)!=Array.isArray(t.enumeration)||e.enumeration.length!=t.enumeration.length)return!1;for(var r=t.enumeration.length-1;r>-1;r--)if(LIB.indexById(e.enumeration,t.enumeration[r].id)<0)return!1;return!0},LIB.equalPC=(e,t)=>Array.isArray(e.values)==Array.isArray(t.values)&&(e.title==t.title&&LIB.equalKey(e.dataType,t.dataType)&&(!Array.isArray(e.values)&&!Array.isArray(t.values)||LIB.equalValues(e.values,t.values))&&LIB.equalBoolean(e.multiple,t.multiple)),LIB.equalRC=(e,t)=>e.title==t.title&&LIB.equalBoolean(e.isHeading,t.isHeading)&&LIB.equalKeyL(e.propertyClasses,t.propertyClasses),LIB.equalSC=(e,t)=>{return e.title==t.title&&LIB.equalKeyL(e.propertyClasses,t.propertyClasses)&&r(e.subjectClasses,t.subjectClasses)&&r(e.objectClasses,t.objectClasses)&&LIB.isEqualStringL(e.instantiation,t.instantiation);function r(e,t){return!Array.isArray(t)||LIB.equalKeyL(e,t)}},LIB.isString=e=>"string"==typeof e,LIB.isIsoDateTime=e=>RE.IsoDateTime.test(e),LIB.isEqualStringL=(e,t)=>{let r=Array.isArray(e)&&e.length>0,s=Array.isArray(t)&&t.length>0;if(!r&&!s)return!0;if(!r&&s||r&&!s||e.length!=t.length)return!1;for(var a of e)if(t.indexOf(a)<0)return!1;return!0},LIB.useRemotePath=()=>window.location.href.startsWith("http")||window.location.href.endsWith(".specif.html"),LIB.versionOf=e=>e.specifVersion||RE.versionFromPath.exec(e.$schema)[1],LIB.hasContent=e=>"string"==typeof e&&!/^.{0,2}(?:no entry|empty).{0,2}$/.test(e.toLowerCase())&&(e.stripHTML().length>0||RE.tagSingleObject.test(e)||RE.tagImg.test(e)||RE.tagA.test(e)),LIB.isMultiLanguageValue=e=>{if(Array.isArray(e)){let r=e.length>1;for(var t=e.length-1;t>-1;t--){let s=e[t];if("string"!=typeof s.text||r&&t>0&&("string"!=typeof s.language||s.language.length<2))return!1}return!0}return!1},LIB.multiLanguageValueHasContent=e=>e&&e.length>0&&LIB.isMultiLanguageValue(e)&&LIB.hasContent(e[0].text),LIB.makeMultiLanguageValue=(e,t)=>"string"==typeof e?t&&t.language?[{text:e,language:t.language}]:[{text:e}]:LIB.isMultiLanguageValue(e)?e:void 0,LIB.languageValueOf=(e,t)=>{if(!LIB.isMultiLanguageValue(e))throw console.error("Value must be a multi-language text: ",e),Error("Programming Error: Value must be a multi-language text.");if(e.length<1)return;let r=e.filter((e=>e.language&&t&&t.targetLanguage.toLowerCase()==e.language.toLowerCase()));return r.length>0?r[0]:(r=e.filter((e=>e.language&&t&&t.targetLanguage&&t.targetLanguage.slice(0,2).toLowerCase()==e.language.slice(0,2).toLowerCase())),r.length>0?r[0]:t&&t.dontReturnDefaultValue?void 0:e[0])},LIB.languageTextOf=(e,t)=>{if(!t||!t.targetLanguage)return e;let r=LIB.languageValueOf(e,t);return r?r.text:""},LIB.selectTargetLanguage=(e,t)=>LIB.makeMultiLanguageValue(LIB.languageTextOf(e,t),t),LIB.lookupEnums=(e,t,r)=>{if(r&&r.lookupEnums){let r=LIB.itemByKey(t.propertyClasses,e.class),s=LIB.itemByKey(t.dataTypes,r.dataType);s.enumeration&&(e.values=e.values.map((e=>LIB.itemById(s.enumeration,e.id).value)))}return e},LIB.displayValueOf=(e,t)=>{return t?t.targetLanguage||(t.targetLanguage="default"):t={targetLanguage:"default"},LIB.isMultiLanguageValue(e)?(r=LIB.languageTextOf(e,t),t&&t.lookupValues&&(r=app.ontology.localize(r,t)),t&&t.stripHTML?r.stripHTML():r):e;var r},LIB.propertyByTitle=(e,t,r)=>{if(e&&e.properties){let a;for(var s of e.properties)if(a=LIB.itemByKey(r.propertyClasses,s.class),a&&a.title==t)return s}},LIB.updatePropertyByTitle=(e,t,r,s)=>{let a=LIB.propertyByTitle(e,t,s),i=r();i&&(a.values=i)},LIB.valuesByTitle=(e,t,r)=>{if(e){let i=[];if(e.properties){let n,l;for(var s of e.properties)for(var a of(l=LIB.itemByKey(r.propertyClasses,s.class),t))l&&l.title==a&&(n=LIB.itemByKey(r.dataTypes,l.dataType),n&&(i=i.concat(n.enumeration?s.values.map((e=>LIB.itemById(n.enumeration,e.id).value)):s.values)))}return i}},LIB.valueByTitle=(e,t,r,s)=>{if(e){let a=LIB.valuesByTitle(e,[t],r);return a.length>1&&console.warn("Multiple values for property with title '"+t+"' found in "+e.id+". Only the first one is returned."),a.length>0?LIB.displayValueOf(a[0],s):void 0}},LIB.enumeratedValuesOf=(e,t)=>{var r=e.type?e:LIB.itemByKey(t?t.dataTypes:app.projects.selected.cache.get("dataType",app.projects.selected.dataTypes),e),s=[];if(r.enumeration)for(var a of r.enumeration)s.push(LIB.languageTextOf(a.value,{targetLanguage:"default"}));return s},LIB.mostRecent=(e,t)=>e[LIB.indexByKey(e,{id:t.id})],LIB.duplicateId=(e,t)=>{if(e.id==t)return!0;for(var r in e)if(Array.isArray(e[r]))for(var s=e[r].length-1;s>-1;s--)if(LIB.duplicateId(e[r][s],t))return!0;return!1},LIB.indexBy=(e,t,r)=>{if(e&&t&&r)for(var s=e.length-1;s>-1;s--)if(LIB.isKey(r)?LIB.references(r,e[s][t]):e[s][t]==r)return s;return-1},LIB.itemBy=(e,t,r)=>{if(e&&t&&r)for(var s of e)if(LIB.isKey(r)?LIB.references(r,s[t]):s[t]==r)return s},LIB.indexById=(e,t)=>{if(e&&t){t=t.trim();for(var r=e.length-1;r>-1;r--)if(e[r].id==t)return r}return-1},LIB.itemById=(e,t)=>{if(e&&t){t=t.trim();for(var r=e.length-1;r>-1;r--)if(e[r].id==t)return e[r]}},LIB.itemByTitle=(e,t)=>{if(e&&t)for(var r of e)if(r.title==t)return r},LIB.indexByKey=(e,t)=>{let r=LIB.forAll(e,((e,r)=>{if(e.id==t.id)return{idx:r,rev:e.revision,chAt:e.changedAt}}));if(r.length<1)return-1;if(1==r.length)return t.revision&&r[0].rev!=t.revision?-1:r[0].idx;for(let e of r)e.rev||console.error("Item with id '"+t.id+"' occurs more than once, where at least one does not have a specified revision.");if(t.revision){let e=r.filter((e=>e.rev==t.revision));if(e.length<1)return-1;if(1==e.length)return e[0].idx;throw Error("There are >1 items with the same id '"+t.id+"' and revision '"+t.revision+"'.")}{let s=r.filter((t=>{for(let s of r)if(Array.isArray(e[s.idx].replaces)&&e[s.idx].replaces.includes(t.rev))return!1;return!0}));if(1==s.length)return s[0].idx;if(s.length<1)throw Error("There is a cyclic reference within "+JSON.stringify(e)+"'.");return console.info("There are multiple branches; no item returned for "+JSON.stringify(t)+"."),-1}},LIB.itemByKey=(e,t)=>{let r=LIB.indexByKey(e,t);if(r>-1)return e[r]},LIB.references=(e,t)=>LIB.isKey(t)&&LIB.isKey(e)&&t.id==e.id&&(!e.revision||t.revision==e.revision),LIB.referenceIndex=(e,t)=>{for(var r=e.length-1;r>-1;r--)if(LIB.references(e[r],t))return r;return-1},LIB.referenceIndexBy=(e,t,r)=>{if(e&&t&&r)for(var s=e.length-1;s>-1;s--)if(LIB.references(e[s][t],r))return s;return-1},LIB.referenceItemBy=(e,t,r)=>{let s=LIB.referenceIndexBy(e,t,r);if(s>-1)return e[s]},LIB.containsById=(e,t)=>{if(!e||!t)throw Error("Missing Input Parameter");return Array.isArray(t)?function(e,t){for(var r=t.length-1;r>-1;r--)if(LIB.indexById(e,t[r].id)<0)return!1;return!0}(e,t):LIB.indexById(e,t.id)>-1},LIB.containsAllStrings=(e,t)=>{for(var r=t.length-1;r>-1;r--)if(e.indexOf(t[r])<0)return!1;return!0},LIB.addPCReference=(e,t)=>{Array.isArray(e.propertyClasses)?(LIB.indexById(e.propertyClasses,t.id)<0||LIB.indexByKey(e.propertyClasses,t)<0)&&e.propertyClasses.unshift(t):e.propertyClasses=[t]},LIB.addProperty=(e,t)=>{Array.isArray(e.properties)?e.properties.unshift(t):e.properties=[t]},LIB.addClassesTo=(e,t)=>{let r,s=app.ontology.generateSpecifClasses({terms:[e],delta:!0,referencesWithoutRevision:!0});for(var a of["dataTypes","propertyClasses","resourceClasses","statementClasses"]){LIB.cacheL(t[a],s[a]);let i=LIB.indexBy(t[a],"title",e);i>-1&&(r=t[a][i])}return r||console.error("No class found for term "+e+"."),r},LIB.getExtendedClasses=(e,t)=>{"all"==t&&(t=e.map((e=>LIB.keyOf(e))));let r=[];for(var s of t)r.push(a(s));return r;function a(t){let r={};return function(e,t){let r=[],s=simpleClone(t);do{let t=LIB.itemByKey(e,s);if(!t)throw Error("Did not find extending class "+s.id);s=t.extends,r.unshift(t)}while(s);return r}(e,t).forEach((e=>{for(let t in e)["propertyClasses"].includes(t)?Array.isArray(e[t])&&(Array.isArray(r[t])?LIB.cacheL(r[t],e[t]):r[t]=simpleClone(e[t])):r[t]=simpleClone(e[t])})),delete r.extends,r}},LIB.keepUsedClasses=e=>{return e.statementClasses=t(e.statementClasses,e.statements,e.statementClasses),e.resourceClasses=t(e.resourceClasses,e.resources,e.statementClasses),e.propertyClasses=function(e,t){let r;do{r=e.length,e=e.filter((e=>{if(e.keepEvenIfUnused)return!0;for(let r of t)if(Array.isArray(r.propertyClasses))for(let t of r.propertyClasses)if(LIB.references(t,e))return!0;console.info("Deleting unused ",e.id)}))}while(r>e.length);return e}(e.propertyClasses,e.statementClasses.concat(e.resourceClasses)),e.dataTypes=function(e,t){let r;do{r=e.length,e=e.filter((e=>{for(let r of t)if(LIB.references(r.dataType,e))return!0;console.info("Deleting unused ",e.id)}))}while(r>e.length);return e}(e.dataTypes,e.propertyClasses),e;function t(e,t,r){let s;do{s=e.length,e=e.filter((s=>{if(s.keepEvenIfUnused)return!0;for(let t of e)if(LIB.references(t.extends,s))return!0;for(let e of t)if(LIB.references(e.class,s))return!0;for(let e of r){if(e.subjectClasses)for(let t of e.subjectClasses)if(LIB.references(t,s))return!0;if(e.objectClasses)for(let t of e.objectClasses)if(LIB.references(t,s))return!0}console.info("Deleting unused ",s.id)}))}while(s>e.length);return e}},LIB.cmp=(e,t)=>e?t?(e=e.toLowerCase())==(t=t.toLowerCase())?0:e<t?-1:1:1:-1,LIB.sortByTitle=e=>{e.sort(((e,t)=>LIB.cmp(e.title,t.title)))},LIB.sortBy=(e,t)=>{e.sort(((e,r)=>LIB.cmp(t(e),t(r))))},LIB.forAll=(e,t)=>{if(!e)return[];var r=[];return e.forEach(((e,s)=>{var a=t(e,s);a&&(Array.isArray(a)?r.push(...a):r.push(a))})),r},LIB.addIcon=(e,t)=>t?t+"&#xa0;"+e:e,LIB.cacheE=(e,t)=>{let r="string"==typeof t?e.indexOf(t):LIB.indexById(e,t.id);if(t.predecessor){let s="string"==typeof t.predecessor?e.indexOf(t.predecessor):LIB.indexById(e,t.predecessor.id);if(delete t.predecessor,s>-1)return r>-1&&e.splice(r,1),e.splice(s+1,0,t),s+1}return r>-1?(e[r]=t,r):(e.push(t),e.length-1)},LIB.cacheL=(e,t)=>{for(var r of t)LIB.cacheE(e,r);return!0},LIB.uncacheE=(e,t)=>{let r=LIB.isKey(t)?LIB.indexByKey(e,t):e.indexOf(t);return r>-1&&e.splice(r,1),r},LIB.uncacheL=(e,t)=>{let r=!0;return t.forEach((t=>{r=r&&LIB.uncacheE(e,t)>-1})),r},LIB.randomString=()=>{let e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t="";for(var r=CONFIG.genIdLength;r>0;--r)t+=e[Math.round(61*Math.random())];return t},LIB.genID=e=>((!e||e.length<1)&&(e="ID_"),RE.Id.test(e)||(e="_"+e),e+LIB.randomString()),LIB.getHeight=e=>$(e).outerHeight(!0)??0,String.prototype.toCamelCase=function(){let e,t=this.replace(/[^a-z\d \:\.]/gi,""),r="";if(t.includes(":"))e=t.split(":");else if(t.includes("."))e=t.split(".");else if(t.includes(" "))e=t.split(" ");else if(t.includes("-"))e=t.split("-");else{if(!t.includes("_"))return this;e=t.split("_")}for(let t of e){t=t.replace(/[ _\-\.]/g,"");for(let e=0,s=t.length;e<s;e++)r+=0==e?t[e].toUpperCase():t[e].toLowerCase()}return r},String.prototype.toJsId=function(){return this.replace(/[-:\.\,\s\(\)\[\]\/\\#�%]/g,"_")},String.prototype.toSpecifId=function(){return(/[^_a-zA-Z]/.test(this[0])?"_":"")+this.replace(/[^_a-zA-Z\d.-]/g,"_")},String.prototype.stripHTML=function(){return $("<dummy/>").html(this).text().trim()||""},String.prototype.stripCtrl=function(){return this.replace(/\n|\r|\t|\b|\f|\v/g,"")},String.prototype.ctrl2HTML=function(){return this.replace(/\r|\f/g,"").replace(/&#x0{0,3}a;/gi,"").replace(/\t/g,"&#160;&#160;&#160;&#160;").replace(/\n/g,"<br />").replace(/&#x0{0,3}d;/gi,"<br />")},String.prototype.makeHTML=function(e){if("object"==typeof e&&e.makeHTML){let t=this.linkifyURLs(e).replace(/--(?:&gt;|>)/g,"&#8594;").replace(/(?:&lt;|<)--/g,"&#8592;").replace(/(?:&reg|\(R\))/g,"&#174;").replace(/(?:&copy|\(C\))/g,"&#169;");return CONFIG.convertMarkdown&&window.markdown?window.markdown.render(t.replace(/^\s+/,"").replace(/\+ /g,"&#x2b; ").replace(/• /g,"* ")).replace(/<br ?\/>\n/g,"<br/>").stripCtrl():"<div>"+t.ctrl2HTML()+"</div>"}return this},LIB.xmlChar2utf8=e=>(e=e.replace(/&#x([\da-fA-F]+);/g,(function(e,t){return String.fromCharCode(parseInt(t,16))}))).replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))})),LIB.toHTML=e=>e.escapeHTML().ctrl2HTML(),LIB.isHTML=e=>{let t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.body.childNodes).some((e=>1==e.nodeType))},LIB.escapeInnerHtml=e=>{var t="";return e=e.replace(RE.innerHtmlTag,(function(e,r,s,a,i){return t+=r.escapeXML()+s+a+i,""})),t+=e.escapeXML()},String.prototype.escapeRE=function(){return this.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},String.prototype.escapeJSON=function(){return this.replace(/["\\]/g,"$&").replace(/\u000A/g,"\n").replace(/\u0009/g,"\t").replace(/\[\u0000-\u001F]/g,"")},String.prototype.escapeXML=function(){return this.replace(RE.AmpersandPlus,((e,t)=>RE.XMLEntity.test(e)?e:"&#38;"+t)).replace(/[<>"']/g,(e=>"&#"+{"<":"60",">":"62",'"':"34","'":"39"}[e]+";"))},String.prototype.escapeHTML=function(){return this.replace(/[&<>"'`=\/]/g,(e=>"&#"+{"&":"38","<":"60",">":"62",'"':"34","'":"39","`":"x60","=":"x3D","/":"x2F"}[e]+";"))},String.prototype.unescapeHTMLTags=function(){return LIB.isHTML(this)?this:LIB.noCode(this.replace(RE.escapedHtmlTag,((e,t,r,s)=>"<"+t+r+s+">")))},String.prototype.unescapeHTMLEntities=function(){var e=document.createElement("div");return LIB.noCode(this.replace(/\&#?x?[\da-z]+;/gi,(t=>(e.innerHTML=t,e.innerText))))},String.prototype.linkifyURLs=function(e){return"object"==typeof e&&e.linkifyURLs?this.replace(RE.URI,((t,r,s,a,i,n,l,o,u,c)=>(s.startsWith("http")||(s="https://"+s),r+'<a href="'+s+'" target="_blank" >'+(e&&e.label?e.label:a+(i||"")+n)+"</a>"+c))):this},String.prototype.fileExt=function(){let e=this.lastIndexOf(".");return e<0?"":this.substring(e+1)},String.prototype.baseName=function(){return this.substring(this.lastIndexOf("/")+1)},String.prototype.fileName=function(){let e=this.lastIndexOf(".");return this.substring(0,e<0?this.length:e)},LIB.addFileExtIfMissing=(e,t)=>e==e.fileName()?e+t:e,LIB.addTimezoneIfMissing=e=>"string"!=typeof e||RE.hasTimezone.test(e)?e:(console.info("Added missing time-zone to "+e),e+"Z"),LIB.trimJson=e=>e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),LIB.isTrue=e=>e&&CONFIG.valuesTrue.includes(e.toLowerCase().trim()),LIB.isFalse=e=>e&&CONFIG.valuesFalse.includes(e.toLowerCase().trim()),LIB.ab2str=e=>{let t=new DataView(e);return new TextDecoder("utf-8").decode(t)},LIB.str2ab=e=>(new TextEncoder).encode(e).buffer,LIB.blob2dataURL=(e,t,r)=>{if(!e||!e.blob)return;const s=new FileReader;s.addEventListener("loadend",(r=>{t(r.target.result,e.title,e.type)})),"number"==typeof r&&r>0?setTimeout((()=>{s.readAsDataURL(e.blob)}),r):s.readAsDataURL(e.blob)},LIB.blob2text=(e,t,r)=>{if(!e||!e.blob)return;const s=new FileReader;s.addEventListener("loadend",(r=>{t(r.target.result,e.title,e.type)})),"number"==typeof r&&r>0?setTimeout((()=>{s.readAsText(e.blob)}),r):s.readAsText(e.blob)},LIB.validXML=e=>(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("parsererror").length<1,LIB.uriBack2slash=e=>e.replace(/<(?:object[^>]+?data=|img[^>]+?href=)"([^"]+)"[^>]*?\/?>/g,(e=>e.replace(/(?:data=|href=)"([^"]+)"/g,(e=>e.replace(/\\/g,"/"))))),LIB.noCode=e=>{let t=/<style[^>]*>[\s\S]*<\/style[^>]*>/i;if(e){if(/<[^>]+\son[a-z]+=[^>]+>/i.test(e))return r(911),"";if(/<script[^>]*>[\s\S]*<\/script[^>]*>/i.test(e))return r(912),"";if(t.test(e))return e=e.replace(t,""),console.warn("An inline style definition is considered harmful (913) and has been suppressed"),e;if(/<embed[^>]*>[\s\S]*<\/embed[^>]*>/i.test(e))return r(914),"";if(/<iframe[^>]*>[\s\S]*<\/iframe[^>]*>/i.test(e))return r(915),""}return e;function r(t){console.warn("'"+e+"' is considered harmful ("+t+") and has been suppressed")}},LIB.cleanValue=e=>{if("string"==typeof e)return LIB.noCode(e);if(Array.isArray(e))return LIB.forAll(e,(e=>{let t=LIB.cleanValue(e.text);if(t)return e.text=t,e}));throw Error("Unexpected input to LIB.cleanValue: Programming error with all likelihood")},LIB.attachment2mediaType=e=>{let t=e.fileExt();if(t){let e=CONFIG.imgExtensions.indexOf(t.toLowerCase());if(e>-1)return CONFIG.imgTypes[e];if(e=CONFIG.officeExtensions.indexOf(t.toLowerCase()),e>-1)return CONFIG.officeTypes[e];if(e=CONFIG.applExtensions.indexOf(t.toLowerCase()),e>-1)return CONFIG.applTypes[e]}},LIB.localDateTime=e=>e.length>11?e.substring(0,10)+" "+e.substring(11,16)+"h":e.substring(0,10),LIB.httpGet=e=>{var t=new XMLHttpRequest;t.open("GET",e.url,!0),e.withCredentials&&(t.withCredentials=!0),t.responseType=e.responseType,t.onreadystatechange=function(){if(!(this.readyState<4)){if(4==this.readyState)switch(this.status){case 200:case 201:"function"==typeof e.done&&e.done(this);break;default:"function"==typeof e.fail&&e.fail(this)}"function"==typeof e.then&&e.then()}},t.send(null)},LIB.isReferencedByHierarchy=(e,t)=>(t||(t=app.projects.selected.cache.nodes),LIB.iterateSpecifNodes(t,(t=>t.resource.id!=e.id))),LIB.referencedResources=(e,t)=>{var r=[];return LIB.iterateSpecifNodes(t,(t=>(LIB.cacheE(r,LIB.itemByKey(e,t.resource)),!0))),r},LIB.referencedResourcesByClass=(e,t,r)=>{let s=[];return LIB.iterateSpecifNodes(t,(t=>{let a=LIB.itemById(e,t.resource.id);return a&&r.includes(a.class.id)&&s.push(a),!0})),s},LIB.dataTypeOf=(e,t)=>{if(LIB.isKey(e)){let r=LIB.itemByKey(t.propertyClasses,e),s=r?LIB.itemByKey(t.dataTypes,r.dataType):void 0;if(s)return s;throw Error("dataType of '"+e.id+"' not found in SpecIF data-set with id "+t.id)}return{type:XsDataType.String}},LIB.iterateSpecifNodes=(e,t,r,s)=>{let a=!0;if(Array.isArray(e)){for(let i=0,n=e.length;a&&i<n;i++)a=!LIB.iterateSpecifNodes(e[i],t,r,s);"function"==typeof r&&r(e)}else a=t(e,s),a&&e.nodes&&(s=e.id,a=!LIB.iterateSpecifNodes(e.nodes,t,r,s));return!a},LIB.createProp=(e,t)=>{let r=Array.isArray(e)?LIB.itemByKey(e,t):e;return{class:LIB.keyOf(r),values:r.values??[]}},LIB.propByTitle=(e,t,r)=>{var s,a=LIB.getExtendedClasses(r.resourceClasses,[e.class]);if(a.length<1)throw Error("Data inconsistent: LIB.getExtendedClasses doesn't return a result for "+e.class.id);for(var i of r.propertyClasses)if(LIB.referenceIndex(a[0].propertyClasses,i)>-1&&i.title==t)return(s=LIB.referenceItemBy(e.properties,"class",i))||(s=LIB.createProp(i),e.properties.push(s)),s},LIB.titleOf=(e,t)=>{if(e)return t&&t.lookupTitles?t.targetLanguage?app.ontology.localize(e.title,t):app.ontology.changeNamespace(e.title,t):e.title;throw Error("Programming error: Input parameter 'item' is not defined")},LIB.classTitleOf=(e,t,r)=>{let s=LIB.itemByKey(t,e);if(s)return LIB.titleOf(s,r)},LIB.hasResClass=(e,t,r)=>t.includes(LIB.classTitleOf(e.class,r.resourceClasses)),LIB.hasType=(e,t,r,s)=>{if(e){let a=LIB.valuesByTitle(e,[CONFIG.propClassType],r);return a.length>0&&t.includes(LIB.displayValueOf(a[0],s))}throw Error("Programming Error: No resource or statement specified")},LIB.titleIdx=(e,t)=>{if(Array.isArray(e)&&e.length>0)for(var r=0,s=e.length;r<s;r++){let s=LIB.classTitleOf(e[r].class,t);if(CONFIG.titleProperties.includes(s))return r}return-1},LIB.titleFromProperties=(e,t,r)=>{let s=LIB.titleIdx(e,t);if(s>-1){let t=LIB.languageTextOf(e[s].values[0],r).stripHTML();if(t)return r&&r.lookupValues?app.ontology.localize(t,r):t}return""},LIB.typeOf=(e,t)=>{let r=e.class?e:LIB.itemByKey(t.resources,e),s=LIB.valuesByTitle(r,[CONFIG.propClassType],t);return s.length>0?LIB.displayValueOf(s[0]):void 0};