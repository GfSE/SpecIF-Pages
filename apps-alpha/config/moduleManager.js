"use strict";
/*!	A simple module loader and object (singleton) factory.
    When all registered modules are ready, a callback function is executed to start or continue the application.
    Dependencies: jQuery 3.1 and later.
    (C)copyright enso managers gmbh (http://enso-managers.de)
    Author: se@enso-managers.de, Berlin
    License and terms of use: Apache 2.0 (http://www.apache.org/licenses/LICENSE-2.0)
    We appreciate any correction, comment or contribution as Github issue (https://github.com/enso-managers/SpecIF-Tools/issues)

    See: https://developer.mozilla.org/de/docs/Web/JavaScript/Guide/Modules
*/class ViewControl{constructor(){this.list=[]}exists(e){return LIB.indexBy(this.list,"view",e)>-1}add(e){this.list.push(e),$(e.view).hide()}show(e){if("object"!=typeof e)throw new Error("moduleManager.show() needs a parameter.");let t,s;this.list.forEach((r=>{if(t=$(r.view),s=$(r.selectedBy),e.view==r.view){if(this.selected=r,s.addClass("active"),t.show(),"string"==typeof e.content)return void t.html(e.content);if("function"==typeof r.show)return e.forced=!0,void r.show(e)}else if(s.removeClass("active"),t.hide(),"function"==typeof r.hide)return void r.hide()})),"function"==typeof doResize&&doResize()}hide(e){"string"==typeof e&&this.exists(e)?$(e).hide():this.selected&&($(this.selected.view).hide(),$(this.selected.selectedBy).removeClass("active"),this.selected=void 0)}}class Browser{constructor(){this.language=navigator.language,console.info("Browser Language is '"+this.language+"'."),this.supportsHtml5History=Boolean(window.history&&window.history.pushState),this.supportsHtml5History||console.info("Browser does not support HTML5 History"),this.supportsFileAPI=Boolean(window.File&&window.FileReader&&window.FileList&&window.Blob)}isIE(){return/MSIE |rv:11.0/i.test(navigator.userAgent)}}var app,browser,message,moduleManager=function(){var e={};let t,s="./",r=0;return e.init=r=>{if((browser=new Browser).isIE()){let e="Stopping: The web-browser Internet Explorer is not supported.";return console.error(e),void alert(e)}r&&r.path&&(s=r.path),e.registered=new Set,e.ready=new Set;let n=["bootstrap","font","types","standards","i18n","helper","xSpecif","ioOntology"];return CONFIG.convertMarkdown&&n.push("markdown"),void function(e,s){if(!s||"function"!=typeof s.done)throw new Error("No callback provided to continue after initializing.");t=s.done;e.forEach((e=>{i(e)}))}(n,{done:function(){(app=window.SpecifApp()).busy=new State({showWhenSet:["#spinner"],hideWhenSet:[".pageActions",".contentActions"]}),window.onresize=doResize}})},e.load=(s,r)=>(e.tree=s,r&&"function"==typeof r.done&&(t=r.done),void function e(t){if(t.view&&t.parent){let e=t.viewClass?'class="'+t.viewClass+'" ':"",s='<div id="'+t.view.substring(1)+'" '+e+'style="display:none;"></div>';$(t.parent.view).append(s)}t.name&&i(t);t.children&&s(t);return;function s(t){if(t.selector){if(t.viewControl=new ViewControl,$(t.selector).length<1){let e="";if("btns"===t.selectorType)e='<div id="'+t.selector.substring(1)+'" class="btn-group" ></div>';else e='<ul id="'+t.selector.substring(1)+'" role="tablist" class="nav nav-tabs"></ul>';$(t.view).append(e)}let e=null,s=null;t.children.forEach((function(r){if(r.view){if(!r.selectedBy)throw new Error("Module '"+r.name+"' must have both properties 'view' and 'selectedBy' or none.");if(t.viewControl.add(r),e=r.selectedBy.substring(1),s=r.label||e,"btns"===t.selectorType)$(t.selector).append('<button id="'+e+'" type="button" class="btn btn-light" onclick="moduleManager.show({view:\''+r.view+"'})\" >"+s+"</button>");else $(t.selector).append('<li class="nav-item"><button class="nav-link" id="'+e+'"type = "button" role="tab" onclick="moduleManager.show({view:\''+r.view+"'})\">"+s+"</button></li>")}if(r.action){if(!r.selectedBy)throw new Error("Module '"+r.name+"' must have both properties 'action' and 'selectedBy' or none.");if(e=r.selectedBy.substring(1),s=r.label||e,"btns"!==t.selectorType)throw new Error("Action'"+s+"' needs a parent selector of type 'btns'.");$(t.selector).append('<button id="'+e+'" type="button" class="btn btn-light" onclick="'+r.action+'" >'+s+"</button>")}}))}t.children.forEach((s=>{s.parent=t,e(s)}))}}(s)),e.construct=(t,s)=>{let r=n(e.tree,t.name??t.view);if(!r)throw new Error(t.name?"'"+t.name+"' is not a defined module name":"'"+t.view+"' is not a defined view");Object.assign(r,t),r.loadAs||(r.loadAs=r.name??r.view.substring(1)),s(r),app[r.loadAs]=r,t.name&&e.registered.has(t.name)&&c(t.name)},e.show=t=>{if("object"!=typeof t)throw new Error("Undefined target view.");let s=n(e.tree,t.view);if(!s||!s.parent.viewControl)throw new Error("'"+t.view+"' is not a defined view");return function e(t,s){t.parent.selectedBy&&e(t.parent,Object.assign({},s,{view:t.parent.view}));t.parent.viewControl.show(s)}(s,t),void function e(t,s){if(t.viewControl&&t.viewControl.list.length>0){let r=function(e){for(var t=e.length-1;t>-1;t--)if(e[t].isDefault)return e[t];return e[0]}(t.viewControl.list);t.viewControl.show(Object.assign({},s,{view:r.view})),e(r,s)}}(s,t)},e.isRegistered=t=>e.registered.has(t),e.isReady=t=>e.ready.has(t),e;function n(e,t){let s;if(Array.isArray(e))for(var r=e.length-1;!s&&r>-1;r--)s=i(e[r]);else s=i(e);return s;function i(e){if(e.name==t||e.view==t)return e;if(e.children){let s=n(e.children,t);if(s)return s}}}function i(t){var n="string"==typeof t?{name:t}:t;return void(function(t){return e.registered.has(t)?(console.warn("WARNING: Did not reload module '"+t+"'."),!1):(e.registered.add(t),!0)}(n.name)&&function t(s,n){(!Array.isArray(s.requires)||new Set(s.requires).isSubsetOf(e.ready))&&r<9?n(s.name):setTimeout((function(){t(s,n)}),33)}(n,(function(t){switch(r++,t){case"font":return a("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"),c(t),!0;case"bootstrap":return a("https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"),l("https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"),!0;case"tree":return i("helperTree"),a("https://cdn.jsdelivr.net/npm/jqtree@1.8.10/jqtree.css"),l("https://cdn.jsdelivr.net/npm/jqtree@1.8.10/tree.jquery.js"),!0;case"fileSaver":return l("https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"),!0;case"zip":return l("https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"),!0;case"jsonSchema":return l("https://cdnjs.cloudflare.com/ajax/libs/ajv/4.11.8/ajv.min.js"),!0;case"excel":return l("https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"),!0;case"bpmnViewer":return l("https://unpkg.com/bpmn-js@17.9.2/dist/bpmn-viewer.production.min.js"),!0;case"graphViz":return l("https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/standalone/umd/vis-network.min.js"),!0;case"pouchDB":return l("https://cdn.jsdelivr.net/npm/pouchdb@9.0.0/dist/pouchdb.min.js"),!0;case"markdown":return l("https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js").done((()=>{window.markdown=window.markdownit({html:!0,xhtmlOut:!0,breaks:!0,linkify:!1})})),!0;case"types":return l(s+"types/specif.types.js"),!0;case"i18n":switch(browser.language.slice(0,2)){case"de":l(s+"config/locales/iLaH-de.i18n.js");break;case"fr":l(s+"config/locales/iLaH-fr.i18n.js");break;default:l(s+"config/locales/iLaH-en.i18n.js")}return!0;case"helper":return l(s+"modules/helper.js").done((()=>{message=new CMessage})),!0;case"standards":return l(s+"modules/standards.js"),!0;case"ioOntology":return l(s+"modules/ioOntology.js"),!0;case"helperTree":return l(s+"modules/helperTree.js"),!0;case"xSpecif":return l(s+"modules/xSpecif.js"),!0;case"projects":return i("fileSaver"),l(s+"modules/cache.mod.js"),!0;case"profileAnonymous":return l(s+"modules/profileAnonymous.mod.js"),!0;case"toHtml":return l(s+"modules/specif2html.js"),!0;case"toXhtml":return e.isRegistered("makeXhtml")||i("makeXhtml"),l(s+"modules/specif2xhtml.js"),!0;case"toEpub":return e.isRegistered("makeXhtml")||i("makeXhtml"),l(s+"assets/javascripts/toEpub.js"),!0;case"makeXhtml":return l(s+"assets/javascripts/makeXhtml.js"),!0;case"toOxml":return l(s+"assets/javascripts/toOxml.js"),!0;case"toTurtle":return l(s+"modules/specif2turtle.js"),!0;case"bpmn2specif":return l(s+"assets/javascripts/BPMN2SpecIF.js"),!0;case"archimate2specif":return l(s+"assets/javascripts/archimate2SpecIF.js"),!0;case"sysml2specif":return l(s+"modules/sysml2specif.js"),!0;case"reqif2specif":return l(s+"assets/javascripts/reqif2specif.js"),!0;case"vicinityGraph":return i("graphViz"),l(s+"modules/graph.js"),!0;case"serverPouch":return i("pouchDB"),l(s+"modules/serverPouch.mod.js"),!0;case"sheet2reqif":case"importAny":i("zip"),i("jsonSchema");case"about":case"ioSpecif":case"ioDdpSchema":case"ioReqif":case"ioJsonld":return l(s+"modules/"+t+".mod.js"),!0;case"ioXls":return i("excel"),l(s+"modules/ioXls.mod.js"),!0;case"ioBpmn":return i("bpmnViewer"),i("bpmn2specif"),l(s+"modules/ioBpmn.mod.js"),!0;case"ioArchimate":return i("archimate2specif"),l(s+"modules/ioArchimate.mod.js"),!0;case"ioSysml":return i("sysml2specif"),l(s+"modules/ioSysml.mod.js"),!0;case CONFIG.specifications:return i("tree"),l(s+"modules/specifications.mod.js"),!0;case CONFIG.reports:return l(s+"modules/reports.mod.js"),!0;case CONFIG.objectFilter:return l(s+"modules/filter.mod.js"),!0;case CONFIG.resourceEdit:return l(s+"modules/resourceEdit.mod.js"),!0;case CONFIG.resourceLink:return l(s+"modules/resourceLink.mod.js"),!0;default:return console.warn("Module loader: Module '"+t+"' is unknown."),!1}})));function l(e,t){let s=Object.assign(t??{},{dataType:"script",cache:!0,url:o(e)});return e.indexOf(".mod.")>0?$.ajax(s):$.ajax(s).done((()=>{c(n.name)}))}}function o(e){return e+(e.startsWith(s)?"?"+CONFIG.appVersion:"")}function a(e){$("head").append('<link rel="stylesheet" type="text/css" href="'+o(e)+'" />')}function c(n){if(e.ready.has(n))throw new Error("Module '"+n+"' cannot be set 'ready' more than once");if(r--,e.ready.add(n),console.info("Loaded module '"+n+"' ("+e.ready.size+" of "+e.registered.size+")."),e.registered.size===e.ready.size){if(e.tree?(a(s+"assets/stylesheets/SpecIF.default.css"),(i=e.tree)&&function e(t){"function"==typeof t.init&&t.init(),t.children&&t.children.forEach((t=>{e(t)}))}(i),console.info("All "+e.ready.size+" modules loaded --\x3e ready!")):console.info("Initialization completed!"),"function"!=typeof t)throw new Error("No callback provided to continue after module loading.");t()}var i}}();class State{constructor(e){this.state=!1,this.showWhenSet=Array.isArray(e.showWhenSet)?e.showWhenSet:[],this.hideWhenSet=Array.isArray(e.hideWhenSet)?e.hideWhenSet:[]}set(e){switch(e){case!1:this.reset();break;case void 0:case!0:this.state=!0,this.hideWhenSet.forEach((e=>{$(e).hide()})),this.showWhenSet.forEach((e=>{$(e).show()}))}}reset(){this.state=!1,this.showWhenSet.forEach((e=>{$(e).hide()})),this.hideWhenSet.forEach((e=>{$(e).show()}))}get(){return this.state}}function doResize(){let e=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-(LIB.getHeight("#pageHeader")+LIB.getHeight(".nav-tabs"));$(".content").outerHeight(e),$(".contentWide").outerHeight(e),$(".pane-tree").css("max-height",e),$(".pane-details").css("max-height",e),$("#aboutFrame").outerHeight(e-8)}