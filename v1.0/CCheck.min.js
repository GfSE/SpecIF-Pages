var CCheck=function(){this.ajv=new Ajv({allErrors:!0})};CCheck.prototype.checkSchema=function(e,p){if(!p||!p.schema)return null;"boolean"!=typeof p.allErrors&&(p.allErrors=!0);var u=this.ajv.compile(p.schema);return u(e)?{status:0,statusText:"SpecIF schema has been checked successfully!"}:{status:901,statusText:"SpecIF schema is violated",responseType:"text",responseText:this.ajv.errorsText(u.errors)}};
CCheck.prototype.checkConstraints=function(e,p){function u(c,b,d){Array.isArray(c)&&b.forEach(function(a){a[d]&&!l(c,a[d])&&g.push({status:903,statusText:"item with identifier '"+a.id+"' must reference a valid "+d})})}function G(c){Array.isArray(c)&&c.forEach(function(b){Array.isArray(b[D])&&b[D].forEach(function(d){e.propertyClasses?void 0==l(e.propertyClasses,d)&&g.push({status:930,statusText:"property class of item with identifier '"+b.id+"' must reference an item in 'propertyClasses'"}):(void 0==
l(e.dataTypes,d.dataType)&&g.push({status:904,statusText:"property class with identifier '"+d.id+"' must reference a valid dataType"}),H(d,d,"property class '"+d.id+"'"))})})}function H(c,b,d){if(b=b.value){var a=l(e.dataTypes,c.dataType);if(a)switch(a.type){case "xhtml":case "xs:string":if(void 0==a.maxLength||-1<p.dontCheck.indexOf("text.length"))break;var h=d+": string value must not exceed maxLength";switch(typeof b){case "object":b.forEach(function(f){f.text.length>a.maxLength&&g.push({status:921,
statusText:h})});break;case "string":b.length>a.maxLength&&g.push({status:921,statusText:h})}break;case "xs:double":b=parseFloat(b);"NaN"==b&&g.push({status:925,statusText:d+": value is an invalid number"});a[w]&&b<a[w]&&g.push({status:923,statusText:d+": double value must be larger than min"});a[x]&&b>a[x]&&g.push({status:924,statusText:d+": double value must be smaller than max"});break;case "xs:integer":b=parseInt(b);"NaN"==b&&g.push({status:925,statusText:d+": value is an invalid number"});a[w]&&
b<a[w]&&g.push({status:923,statusText:d+": integer value must be larger than min"});a[x]&&b>a[x]&&g.push({status:924,statusText:d+": integer value must be smaller than max"});break;case "xs:boolean":"true"!=b&&"false"!=b&&g.push({status:925,statusText:d+": boolean value is an invalid"});break;case "xs:enumeration":b=b.split(","),1<b.length&&!(c.multiple||"boolean"!=typeof c.multiple&&a.multiple)&&g.push({status:926,statusText:d+": may not have more than one value"}),b.forEach(function(f){f=f.trim();
var k;if(k=f){a:{k=a.values;if(Array.isArray(k)&&f){f=f.trim();for(var m=k.length-1;-1<m;m--)if(k[m].id===f){k=m;break a}}k=-1}k=0>k}k&&g.push({status:927,statusText:d+": enumerated values must be defined by the respective property type"})})}else g.push({status:904,statusText:"propertyClass with identifier '"+c.id+"' must reference a valid dataType"})}}function I(c,b,d){if(Array.isArray(c)&&Array.isArray(b)){var a,h,f,k;b.forEach(function(m){m.properties&&(h=l(c,m[d]))&&m.properties.forEach(function(n){k=
"property with class '"+(n[E].id||n[E])+"' of instance with identifier '"+m.id+"'";e.propertyClasses?(f=l(c,h["extends"]),h.propertyClasses&&l(h.propertyClasses,n["class"])||f&&f.propertyClasses&&l(f.propertyClasses,n["class"])||g.push({status:920,statusText:k+": class must be listed with the instance class or the extended instance class"}),a=l(e.propertyClasses,n["class"])):a=l(h[D],n[E]);a?H(a,n,k):g.push({status:920,statusText:k+" must reference a valid propertyClass"})})})}}function J(c,b,d){b&&
b.forEach(function(a){!(0<d)&&r||l(c,a.resource)||g.push({status:909,statusText:"hierarchy node with identifier '"+a.id+"' must reference a valid resource"});J(c,a.nodes,d+1)})}function l(c,b){function d(f){switch(typeof f){case "object":return f;case "string":return{id:f}}}var a=d(b);if(a&&Array.isArray(c)){var h=c.map(d).filter(function(f){return f.id==a.id});if(!(1>h.length)){if(1==h.length&&!h[0].revision)return a.revision?void 0:h[0];h.sort(function(f,k){return k.changedAt-f.changedAt});if(!a.revision)return h[0];
h=h.filter(function(f){return f.revision==a.revision});if(0<h.length)return h[0]}}}function M(c){var b="";c.forEach(function(d){b+=(b.length?",\n":"")+d.statusText+" ("+status+")"});return b}if(e.specifVersion&&-1<e.specifVersion.indexOf("0.9."))return{status:900,statusText:"SpecIF version 0.9.x is not any more supported!"};switch(e.$schema||e.specifVersion){case "0.10.0":case "0.10.1":case "0.10.7":case "0.11.0":case "0.11.7":return{status:900,statusText:"SpecIF version "+e.specifVersion+" is not any more supported!"};
case "0.10.2":case "0.10.3":case "0.11.1":var K=!0,t="resourceTypes",q="statementTypes",r="hierarchyTypes",D="propertyTypes",v="resourceType",y="statementType",F="hierarchyType",E="propertyType",B="subjectTypes",C="objectTypes";break;case "0.10.4":case "0.10.5":case "0.11.2":K=!0;case "0.10.6":case "0.11.6":r="hierarchyClasses",F="class";default:t="resourceClasses",q="statementClasses",D="propertyClasses",E=y=v="class",B="subjectClasses",C="objectClasses"}if(e.specifVersion)var w="min",x="max";else w=
"minInclusive",x="maxInclusive";"object"!=typeof p&&(p={});Array.isArray(p.dontCheck)||(p.dontCheck=[]);var g=[];(function(c){function b(h){if(h&&!(1>h.length))for(var f,k,m=h.length-1;-1<m;m--)if(void 0!=h[m].id){k=h[m];a:{for(var n=k.revision||0,z=d.length-1;-1<z;z--)if(f=d[z].revision||0,d[z].id==k.id&&(f==n||0==f||0==n)){f=!0;break a}f=!1}if(f)return k;if((f=b(k.values))||K&&(f=b(k[D]))||(f=b(k.properties))||(f=b(k.nodes)))return f;d.push(k)}}var d=[],a=b(c.dataTypes);a&&g.push({status:911,statusText:"dataType "+
a.id+" with revision "+a.revision+" is not unique"});(a=b(c.propertyClasses))&&g.push({status:911,statusText:"propertyClass "+a.id+" with revision "+a.revision+" is not unique"});(a=b(c[t]))&&g.push({status:911,statusText:v+" or propertyClass "+a.id+" with revision "+a.revision+" is not unique"});(a=b(c[q]))&&g.push({status:911,statusText:y+" or propertyClass "+a.id+" with revision "+a.revision+" is not unique"});(a=b(c[r]))&&g.push({status:911,statusText:F+" or propertyClass "+a.id+" with revision "+
a.revision+" is not unique"});(a=b(c.resources))&&g.push({status:911,statusText:"resource "+a.id+" with revision "+a.revision+" is not unique"});(a=b(c.statements))&&g.push({status:911,statusText:"statement "+a.id+" with revision "+a.revision+" is not unique"});(a=b(c.hierarchies))&&g.push({status:911,statusText:"hierarchy "+a.id+" with revision "+a.revision+" is not unique"});(a=b(c.files))&&g.push({status:911,statusText:"file identifier '"+a.id+"' with revision "+a.revision+" is not unique"})})(e);
(function(c){Array.isArray(c)&&c.forEach(function(b){switch(b.type){case "xs:double":case "xs:integer":b[w]+1>b[x]&&g.push({status:929,statusText:"if number types have "+w+" and "+x+", the former must be smaller or equal than the latter"})}})})(e.dataTypes);(function(c){Array.isArray(c)&&c.forEach(function(b){void 0==l(e.dataTypes,b.dataType)&&g.push({status:904,statusText:"property class with identifier '"+b.id+"' must reference a valid dataType"});H(b,b,"property class '"+b.id+"'")})})(e.propertyClasses);
G(e[t]);G(e[q]);r&&G(e[r]);(function(){function c(d,a){if(a)for(var h=a.length-1;-1<h;h--)if(void 0==l(d,a[h]))return!1;return!0}var b=e[t].concat(e[q]);e[q].forEach(function(d){c(b,d[B])||g.push({status:906,statusText:B+" of "+y+" with identifier '"+d.id+"' must reference a valid "+v});c(b,d[C])||g.push({status:907,statusText:C+" of "+y+" with identifier '"+d.id+"' must reference a valid "+v})})})();u(e[t],e[t],"extends");u(e[q],e[q],"extends");u(e[t],e.resources,v);u(e[q],e.statements,y);r&&u(e[r],
e.hierarchies,F);I(e[t],e.resources,v);I(e[q],e.statements,y);r&&I(e[r],e.hierarchies,F);(function(c,b){var d=c.resources.concat(c.statements),a=c[t].concat(c[q]);b.forEach(function(h,f){var k=l(d,h.subject),m=l(d,h.object);!k&&0>p.dontCheck.indexOf("statement.subject")&&g.push({status:908,statusText:"subject of statement["+f+"] with identifier '"+h.id+"' must reference a valid resource or statement"});!m&&0>p.dontCheck.indexOf("statement.object")&&g.push({status:909,statusText:"object of statement["+
f+"] with identifier '"+h.id+"' must reference a valid resource or statement"});var n=l(c[q],h[y]);if(Array.isArray(n[B])&&k){var z=[];n[B].forEach(function(A){(A=l(a,A))&&z.push(A)});l(z,k[v])||g.push({status:919,statusText:"the subject of statement["+f+"] with identifier '"+h.id+"' has a class which is not listed in the "+B+" of the statement's class"})}if(Array.isArray(n[C])&&m){var L=[];n[C].forEach(function(A){(A=l(a,A))&&L.push(A)});l(L,m[[v]])||g.push({status:919,statusText:"the object of statement["+
f+"] with identifier '"+h.id+"' has a class which is not listed in the "+C+" of the statement's class"})}})})(e,e.statements);J(e.resources,e.hierarchies,0);return 1>g.length?{status:0,statusText:"SpecIF constraints have been checked successfully!"}:{status:902,statusText:"SpecIF constraints are violated",responseType:"text",responseText:M(g)}};